<%- include('header') %>

    <div class="row" style="width: 100%;">
        <%- include('partials') %>
            <div class="products-list col-md-10" >

                <div class="product-title">
                    <h3 style="font-family: 'Exo 2', sans-serif;">PRODUCTS</h3>
                </div>
                <br>
                <div class="row" id="products-container">
                    <% products.forEach(product=> { %>
                        <div class="col-md-4">
                            <a href="/product/<%= product._id %>" class="text-decoration-none">
                                <div class="card-unique">
                                    <img class="card-img-top" src="/uploads/<%= product.images[0] %>"
                                        alt="<%= product.productName %>">
                                    <div class="card-body">
                                        <h5 class="card-title single-line">
                                            <%= product.productName %>
                                        </h5>
                                        <h6 class="card-text-prod">Brand: <%= product.brand %>
                                        </h6>
                                        <h6 class="card-text-prod" style="font-weight: bold; font-size: 1.2em;">â‚¹ <%=
                                                product.price %>
                                        </h6>
                                        <h6 class="card-text-prod">Color: <%= product.colour %>
                                        </h6>
                                        <form action="/cart/add" method="POST">
                                            <input type="hidden" name="productId" value="<%= product._id %>">
                                            <!-- <a href=""  class="btn btn-primary" data-product="<%= product._id %>">Add to Cart</a> -->
                                            <a> <button type="submit" class="btn btn-primary">Add to Cart</button></a>
                                        </form>


                                    </div>





                                </div>
                            </a>
                            <br>
                        </div>
                        <% }); %>
                </div>

                <!-- Pagination Links -->
<div class="pagination d-flex justify-content-center" >
    <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %>" class="btn prev-next">Previous</a>
    <% } %>
    
    <div class="page-info" style="padding-left: 10px; padding-right: 10px;">
        <span>Page <%= currentPage %> of <%= totalPages %></span>
    </div>  
    
    <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %>" class="btn prev-next">Next</a>
    <% } %>
</div>

            </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Check if there's a message query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const message = urlParams.get("message");

            if (message) {
                // Show a SweetAlert2 pop-up with the message
                Swal.fire({
                    icon: 'success', // Success icon
                    title: 'Added to Cart', // Message title
                    text: message, // Message text from the query parameter
                });
            }
        });

        const productsContainer = document.getElementById("products-container");

// Function to render products on the page
function renderProducts(products) {
    // Clear the existing product listing
    productsContainer.innerHTML = "";

    // Render the filtered products
    products.forEach((product) => {
        const productElement = document.createElement("div");
        // Create and configure productElement with product data
        // ...

        // Append productElement to the container
        productsContainer.appendChild(productElement);
    });
}

// Handle the form submission for price range filtering
const priceRangeForm = document.getElementById("priceRangeForm");
priceRangeForm.addEventListener("submit", (event) => {
    event.preventDefault(); // Prevent the form from submitting the traditional way

    const minPrice = document.getElementById("minPrice").value;
    const maxPrice = document.getElementById("maxPrice").value;

    // Fetch filtered products based on the selected price range
    fetch(`/products/filter?minPrice=${minPrice}&maxPrice=${maxPrice}`)
        .then((response) => response.json())
        .then((products) => {
            renderProducts(products);
        })
        .catch((error) => {
            console.error("Error fetching filtered products:", error);
        });
});
    </script>



    <%- include('footer') %>